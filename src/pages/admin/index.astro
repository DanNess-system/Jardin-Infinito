---
import AdminLayout from '../../layouts/AdminLayout.astro';
import AdminPanel from '../../components/AdminPanel.astro';

// Verificar autenticación en el servidor
const sessionToken = Astro.cookies.get('session')?.value;

if (!sessionToken) {
  return Astro.redirect('/login');
}

// Verificar sesión válida
try {
  const response = await fetch(`${Astro.url.origin}/api/auth/me`, {
    headers: {
      'Cookie': `session=${sessionToken}`
    }
  });
  const data = await response.json();
  
  if (!data.success || !data.authenticated) {
    return Astro.redirect('/login');
  }

  var user = data.user;
} catch (error) {
  console.error('Error verificando sesión:', error);
  return Astro.redirect('/login');
}
---

<AdminLayout title="Panel de Administración - Jardín Infinito" description="Gestiona productos, servicios y configuración de tu sitio web">
  <AdminPanel user={user} />
</AdminLayout>
